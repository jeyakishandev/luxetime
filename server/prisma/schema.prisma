// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  nom       String
  prenom    String
  email     String   @unique
  motDePasse String
  telephone String?
  role      Role     @default(CLIENT)
  
  // Adresse
  adresseRue      String?
  adresseVille    String?
  adresseCodePostal String?
  adressePays    String?
  
  // Relations
  panier     PanierItem[]
  commandes  Commande[]
  avis       Avis[]
  favoris    Favori[]
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("users")
}

model Produit {
  id          Int      @id @default(autoincrement())
  nom         String   @unique
  description String
  prix        Float
  prixPromo   Float?
  marque      String
  reference   String   @unique
  categorie   Categorie
  stock       Int      @default(0)
  
  // Caractéristiques techniques
  mouvement  String?
  boitier    String?
  bracelet   String?
  etanche    String?
  diametre   String?
  poids      String?
  
  // Métadonnées
  tags       String[]
  estEnVente Boolean  @default(true)
  estNouveau Boolean  @default(false)
  noteMoyenne Float   @default(0)
  nombreAvis Int      @default(0)
  vues       Int      @default(0)
  
  // Relations
  images     ImageProduit[]
  panierItems PanierItem[]
  commandeItems CommandeItem[]
  avis       Avis[]
  favoris    Favori[]
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("produits")
}

model ImageProduit {
  id        Int     @id @default(autoincrement())
  url       String
  alt       String  @default("")
  estPrincipale Boolean @default(false)
  produitId Int
  produit   Produit @relation(fields: [produitId], references: [id], onDelete: Cascade)
  
  @@map("image_produits")
}

model PanierItem {
  id        Int     @id @default(autoincrement())
  quantite  Int     @default(1)
  userId    Int
  produitId Int
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  produit   Produit @relation(fields: [produitId], references: [id], onDelete: Cascade)
  
  @@unique([userId, produitId])
  @@map("panier_items")
}

model Commande {
  id        Int      @id @default(autoincrement())
  numero    String   @unique
  statut    StatutCommande @default(EN_ATTENTE)
  
  // Client
  clientId  Int
  client    User     @relation(fields: [clientId], references: [id])
  
  // Adresses
  adresseLivraisonNom     String
  adresseLivraisonPrenom  String
  adresseLivraisonRue     String
  adresseLivraisonVille   String
  adresseLivraisonCodePostal String
  adresseLivraisonPays    String
  adresseLivraisonTelephone String
  
  adresseFacturationNom     String
  adresseFacturationPrenom  String
  adresseFacturationRue     String
  adresseFacturationVille   String
  adresseFacturationCodePostal String
  adresseFacturationPays    String
  
  // Totaux
  sousTotal     Float
  fraisLivraison Float @default(0)
  reduction     Float @default(0)
  total         Float
  
  // Paiement
  methodePaiement MethodePaiement
  transactionId   String?
  
  // Livraison
  dateLivraison DateTime?
  numeroSuivi   String?
  notes         String?
  
  // Relations
  items CommandeItem[]
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("commandes")
}

model CommandeItem {
  id         Int     @id @default(autoincrement())
  quantite   Int
  prixUnitaire Float
  nomProduit String
  commandeId Int
  produitId  Int
  commande   Commande @relation(fields: [commandeId], references: [id], onDelete: Cascade)
  produit    Produit  @relation(fields: [produitId], references: [id])
  
  @@map("commande_items")
}

model Avis {
  id        Int     @id @default(autoincrement())
  note      Int     // 1-5
  commentaire String?
  userId    Int
  produitId Int
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  produit  Produit @relation(fields: [produitId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt DateTime @default(now())
  
  @@unique([userId, produitId])
  @@map("avis")
}

model Favori {
  id        Int     @id @default(autoincrement())
  userId    Int
  produitId Int
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  produit   Produit @relation(fields: [produitId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt DateTime @default(now())
  
  @@unique([userId, produitId])
  @@map("favoris")
}

// Enums
enum Role {
  CLIENT
  ADMIN
}

enum Categorie {
  HOMME
  FEMME
  UNISEXE
  VINTAGE
  SPORT
}

enum StatutCommande {
  EN_ATTENTE
  CONFIRMEE
  EN_PREPARATION
  EXPEDIEE
  LIVREE
  ANNULEE
}

enum MethodePaiement {
  CARTE
  PAYPAL
  VIREMENT
}
